"use strict";!function(){function t(t,e){CKEDITOR.tools.extend(this,e,{editor:t,id:"cke-"+CKEDITOR.tools.getUniqueId(),area:t._.notificationArea}),e.type||(this.type="info"),this.element=this._createElement(),t.plugins.clipboard&&CKEDITOR.plugins.clipboard.preventDefaultDropOnElement(this.element)}function e(t){var e=this;this.editor=t,this.notifications=[],this.element=this._createElement(),this._uiBuffer=CKEDITOR.tools.eventsBuffer(10,this._layout,this),this._changeBuffer=CKEDITOR.tools.eventsBuffer(500,this._layout,this),t.on("destroy",function(){e._removeListeners(),e.element.remove()})}CKEDITOR.plugins.add("notification",{lang:"az,ca,cs,da,de,de-ch,en,en-au,eo,es,es-mx,eu,fr,gl,hr,hu,id,it,ja,km,ko,ku,nb,nl,oc,pl,pt,pt-br,ro,ru,sk,sv,tr,ug,uk,zh,zh-cn",init:function(n){n._.notificationArea=new e(n),n.showNotification=function(t,e,i){"progress"==e?o=i:s=i;var o,s,i=new CKEDITOR.plugins.notification(n,{message:t,type:e,progress:o,duration:s});return i.show(),i},n.on("key",function(t){var e,i,o;27==t.data.keyCode&&(e=n._.notificationArea.notifications).length&&(i=n.lang.notification.closed,(o=new CKEDITOR.dom.element("div")).setStyles({position:"fixed","margin-left":"-9999px"}),o.setAttributes({"aria-live":"assertive","aria-atomic":"true"}),o.setText(i),CKEDITOR.document.getBody().append(o),setTimeout(function(){o.remove()},100),e[e.length-1].hide(),t.cancel())})}}),t.prototype={show:function(){!1!==this.editor.fire("notificationShow",{notification:this})&&(this.area.add(this),this._hideAfterTimeout())},update:function(t){var e=!0,i=(!1===this.editor.fire("notificationUpdate",{notification:this,options:t})&&(e=!1),this.element),o=i.findOne(".cke_notification_message"),s=i.findOne(".cke_notification_progress"),n=t.type;i.removeAttribute("role"),(n=t.progress&&"progress"!=this.type?"progress":n)&&(i.removeClass(this._getClass()),i.removeAttribute("aria-label"),this.type=n,i.addClass(this._getClass()),i.setAttribute("aria-label",this.type),"progress"!=this.type||s?"progress"!=this.type&&s&&s.remove():(s=this._createProgressElement()).insertBefore(o)),void 0!==t.message&&(this.message=t.message,o.setHtml(this.message)),void 0!==t.progress&&(this.progress=t.progress,s)&&s.setStyle("width",this._getPercentageProgress()),e&&t.important&&(i.setAttribute("role","alert"),this.isVisible()||this.area.add(this)),this.duration=t.duration,this._hideAfterTimeout()},hide:function(){!1!==this.editor.fire("notificationHide",{notification:this})&&this.area.remove(this)},isVisible:function(){return 0<=CKEDITOR.tools.indexOf(this.area.notifications,this)},_createElement:function(){var t,e=this,i=this.editor.lang.common.close,o=new CKEDITOR.dom.element("div");return o.addClass("cke_notification"),o.addClass(this._getClass()),o.setAttributes({id:this.id,role:"alert","aria-label":this.type}),"progress"==this.type&&o.append(this._createProgressElement()),(t=new CKEDITOR.dom.element("p")).addClass("cke_notification_message"),t.setHtml(this.message),o.append(t),t=CKEDITOR.dom.element.createFromHtml('<a class="cke_notification_close" href="javascript:void(0)" title="'+i+'" role="button" tabindex="-1"><span class="cke_label">X</span></a>'),o.append(t),t.on("click",function(){e.editor.focus(),e.hide()}),o},_getClass:function(){return"progress"==this.type?"cke_notification_info":"cke_notification_"+this.type},_createProgressElement:function(){var t=new CKEDITOR.dom.element("span");return t.addClass("cke_notification_progress"),t.setStyle("width",this._getPercentageProgress()),t},_getPercentageProgress:function(){return Math.round(100*(this.progress||0))+"%"},_hideAfterTimeout:function(){var t,e=this;this._hideTimeoutId&&clearTimeout(this._hideTimeoutId),"number"==typeof this.duration?t=this.duration:"info"!=this.type&&"success"!=this.type||(t="number"==typeof this.editor.config.notification_duration?this.editor.config.notification_duration:5e3),t&&(e._hideTimeoutId=setTimeout(function(){e.hide()},t))}},e.prototype={add:function(t){this.notifications.push(t),this.element.append(t.element),1==this.element.getChildCount()&&(CKEDITOR.document.getBody().append(this.element),this._attachListeners()),this._layout()},remove:function(t){var e=CKEDITOR.tools.indexOf(this.notifications,t);e<0||(this.notifications.splice(e,1),t.element.remove(),this.element.getChildCount())||(this._removeListeners(),this.element.remove())},_createElement:function(){var t=this.editor,e=t.config,i=new CKEDITOR.dom.element("div");return i.addClass("cke_notifications_area"),i.setAttribute("id","cke_notifications_area_"+t.name),i.setStyle("z-index",e.baseFloatZIndex-2),i},_attachListeners:function(){var t=CKEDITOR.document.getWindow(),e=this.editor;t.on("scroll",this._uiBuffer.input),t.on("resize",this._uiBuffer.input),e.on("change",this._changeBuffer.input),e.on("floatingSpaceLayout",this._layout,this,null,20),e.on("blur",this._layout,this,null,20)},_removeListeners:function(){var t=CKEDITOR.document.getWindow(),e=this.editor;t.removeListener("scroll",this._uiBuffer.input),t.removeListener("resize",this._uiBuffer.input),e.removeListener("change",this._changeBuffer.input),e.removeListener("floatingSpaceLayout",this._layout),e.removeListener("blur",this._layout)},_layout:function(){var t,e,i,o=this.element,s=this.editor,n=s.ui.contentsElement.getClientRect(),r=s.ui.contentsElement.getDocumentPosition(),a=o.getClientRect(),h=this._notificationWidth,l=this._notificationMargin,c=CKEDITOR.document.getWindow(),d=c.getScrollPosition(),c=c.getViewPaneSize(),u=CKEDITOR.document.getBody(),f=u.getDocumentPosition(),m=CKEDITOR.tools.cssLength;h&&l||(i=this.element.getChild(0),h=this._notificationWidth=i.getClientRect().width,l=this._notificationMargin=parseInt(i.getComputedStyle("margin-left"),10)+parseInt(i.getComputedStyle("margin-right"),10)),s.toolbar&&(t=s.ui.space("top"),e=t.getClientRect()),t&&t.isVisible()&&e.bottom>n.top&&e.bottom<n.bottom-a.height?o.setStyles({position:"fixed",top:m(e.bottom)}):0<n.top?o.setStyles({position:"absolute",top:m(r.y)}):r.y+n.height-a.height>d.y?o.setStyles({position:"fixed",top:0}):o.setStyles({position:"absolute",top:m(r.y+n.height-a.height)});var p="fixed"==o.getStyle("position")?n.left:"static"!=u.getComputedStyle("position")?r.x-f.x:r.x;function g(){o.setStyle("left",m(p))}function _(){o.setStyle("left",m(p+n.width-h-l))}n.width<h+l?(r.x+h+l>d.x+c.width?_:g)():r.x+h+l>d.x+c.width?g():r.x+n.width/2+h/2+l>d.x+c.width?o.setStyle("left",m(p-r.x+d.x+c.width-h-l)):n.left+n.width-h-l<0?_():n.left+n.width/2-h/2<0?o.setStyle("left",m(p-r.x+d.x)):o.setStyle("left",m(p+n.width/2-h/2-l/2))}},CKEDITOR.plugins.notification=t}();