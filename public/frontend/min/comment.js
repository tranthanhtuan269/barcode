var totalComments=parseInt($("#total-comment").text()),keyword=$("#keywords_not_good").val().replace(/\s/g,"").split(",");let article_id=$(".detail-article").data("article-id"),barcode_id=$("#barcode-id").val();var typeComment=$("#type-comment").val(),kyTu=["Ă¡","Ă ","áº£","áº¡","Ă£","Äƒ","áº¯","áº±","áº³","áºµ","áº·","Ă¢","áº¥","áº§","áº©","áº«","áº­","a","b","c","d","Ä‘","Ă©","Ă¨","áº»","áº½","áº¹","Ăª","áº¿","á»","á»ƒ","á»…","á»‡","e","f","g","h","Ă­","Ă¬","á»‰","Ä©","á»‹","i","j","k","l","m","n","Ă³","Ă²","á»","Ăµ","á»","Ă´","á»‘","á»“","á»•","á»—","á»™","Æ¡","á»›","á»","á»Ÿ","á»¡","á»£","o","p","q","r","s","t","Ăº","Ă¹","á»§","Å©","á»¥","Æ°","á»©","á»«","á»­","á»¯","á»±","u","v","w","x","y","Ă½","á»³","á»·","á»¹","z","Ă","Ă€","áº¢","áº ","Ăƒ","Ä‚","áº®","áº°","áº²","áº´","áº¶","Ă‚","áº¤","áº¦","áº¨","áºª","áº¬","A","B","C","D","Ä","Ă‰","Ăˆ","áºº","áº¼","áº¸","Ă","áº¾","á»€","á»‚","á»„","á»†","E","F","G","H","Ă","ĂŒ","á»ˆ","Ä¨","á»","I","J","K","L","M","N","Ă“","Ă’","á»","Ă•","á»Œ","Ă”","á»","á»’","á»”","á»–","á»˜","Æ ","á»","á»œ","á»","á» ","á»¢","O","P","Q","R","S","T","Ă","Ă™","á»¦","Å¨","á»¤","Æ¯","á»¨","á»ª","á»¬","á»®","á»°","U","V","W","X","Y","Ă","á»²","á»¶","á»¸","Z","-","Đ"];function dequy(){var n=0;$(".btn-reply").off("click"),$(".btn-reply").on("click",function(){var t=$(this).attr("data-id");$(".repond-"+t).toggleClass("d-none"),n=$(this).attr("data-parent-id")}),$(".btn-submit-comment").off("click"),$(".btn-submit-comment").on("click",function(){var e=$(this).attr("data-id");let t=$(".comment-"+e).val();t=t.trim();var a=$(".author-"+e).val(),o=$(".email-"+e).val();validateComment(t,a,o,e)&&($(".btn-submit-comment").off("click"),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$.ajax({method:"POST",data:{comment:t,email:o,author:a,article_id:article_id,barcode_id:barcode_id,type:typeComment,article_link:window.location.href,parent_id:n},type:"POST",url:"/ajax/comment",beforeSend:function(){$(".ajax_waiting").addClass("loading")},complete:function(){$(".ajax_waiting").removeClass("loading")},success:function(t){Swal.fire({title:"success",text:"Thank you!",type:"success"}),totalComments++,$("#total-comment").html(totalComments),0!=e&&$(".repond-"+e).addClass("d-none"),$(".list-comment-"+e).append(t),$(".comment-"+e).val(""),$(".author-"+e).val(""),$(".email-"+e).val(""),dequy()}}))}),$(".btn-delete-comment").click(function(){Swal.fire({title:"Are you sure?",text:"Do you want to delete?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes",cancelButtonText:"No"}).then(t=>{var e;t.isConfirmed?(e=$(this).data("id"),$(".li-comment-"+e).remove(),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$.ajax({method:"POST",data:{barcode_id:barcode_id,article_id:article_id,comment_id:e},type:"POST",url:"/ajax/delete_comment",beforeSend:function(){$(".ajax_waiting").addClass("loading")},complete:function(){$(".ajax_waiting").removeClass("loading")},success:function(t){$("#total-comment").html(t.totalComments),totalComments=t.totalComments,dequy()}})):t.isDenied&&console.log("User canceled!")})})}function validateComment(t,e,a,o){if(check(keyword,t,e,a))return""==e?(Swal.fire({title:"Error",text:"The name cannot be empty!",type:"error"}),$(".author-"+o).focus(),!1):""==a?(Swal.fire({title:"Error",text:"The email cannot be empty!",type:"error"}),$(".email-"+o).focus(),!1):(atpos=a.indexOf("@"),dotpos=a.lastIndexOf("."),!(atpos<1||dotpos-atpos<2)||(Swal.fire({title:"Error",text:"Please enter a valid email address!",type:"error"}),$(".email-"+o).focus(),!1))}function check(t,e,a,o){if("Barcodelive"==a&&"barcodelive@gmail.com"==o)return!0;if(0==e.length)return Swal.fire({title:"Error",text:"You have not entered content!",type:"error"}),$(".comment-"+data_id).focus(),!1;e=e.toLowerCase();for(var n=0;n<t.length;n++)if(!checkComment(t[n],e))return $(".ajax_waiting").removeClass("loading"),Swal.fire({title:"Error",text:"Your comment contains banned words or links!",type:"error"}),!1;return!detectURLs(e)||($(".ajax_waiting").removeClass("loading"),Swal.fire({title:"Error",text:"Validate comment!",type:"error"}),!1)}function detectURLs(t){return t.match(/(((https?:\/\/)|(www\.))[^\s]+)/g)}function checkComment(t,e){for(var a=t,o="",n=0;n<e.length;n++){var r=o.split("<").length,i=o.split(">").length;if(i<r)o+=e[n];else if(e.substr(n,a.length).toLowerCase()==a.toLowerCase()){i=e.substr(0,n),r=e.substr(n+a.length,e.length-n+a.length);if(-1==kyTu.indexOf(i.substr(i.length-1,1))&&-1==kyTu.indexOf(r.substr(0,1)))return n+=a.length,!1}}return!0}$(".comment-select").on("change",function(){var t=$(this).val();0<parseInt($("#total-comment").text())&&($.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$.ajax({method:"POST",data:{filter_comment:t,article_id:article_id,barcode_id:barcode_id},type:"POST",url:"/ajax/filter_comment",beforeSend:function(){$(".ajax_waiting").addClass("loading")},complete:function(){$(".ajax_waiting").removeClass("loading")},success:function(t){$(".list-comment-0").html(t),dequy()}}))}),dequy();